<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>점프 투 장고 공부 8 | 주경야독학) 개발공부로그</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="점프 투 장고 공부 8" />
<meta name="author" content="Sunmi Moon" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="글쓴이 항목 추가" />
<meta property="og:description" content="글쓴이 항목 추가" />
<link rel="canonical" href="http://localhost:4000/2022-08-24/jump-to-django-8" />
<meta property="og:url" content="http://localhost:4000/2022-08-24/jump-to-django-8" />
<meta property="og:site_name" content="주경야독학) 개발공부로그" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-24T22:25:11+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="점프 투 장고 공부 8" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sunmi Moon","url":"https://moonsunmi.github.io"},"dateModified":"2022-08-24T22:25:11+09:00","datePublished":"2022-08-24T22:25:11+09:00","description":"글쓴이 항목 추가","headline":"점프 투 장고 공부 8","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022-08-24/jump-to-django-8"},"url":"http://localhost:4000/2022-08-24/jump-to-django-8"}</script>
<!-- End Jekyll SEO tag -->


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="주경야독학) 개발공부로그" />

  <!-- Google Analytics-->
  
</head>


  <body>

    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <h2 class="nav-title">주경야독학) 개발공부로그</h2>
    </a>
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/tags">Tags</a></li>
      <li><a href="/about">About</a></li>
    </ul>
  </div>
</nav>


    <main>
      <div class="post">
  <div class="post-info">
    <span>Written by</span>
    
        Sunmi Moon
    

    
      <br>
      <span>on&nbsp;</span><time datetime="2022-08-24 22:25:11 +0900">August 24, 2022</time>
    
  </div>

  <h1 class="post-title">점프 투 장고 공부 8</h1>
  <div class="post-line"></div>

  <h3 id="글쓴이-항목-추가">글쓴이 항목 추가</h3>

<p>models.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_date</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">subject</span>


<span class="k">class</span> <span class="nc">Answer</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">create_date</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">on_delete=models.CASCADE</code>는 계정이 삭제되면 이 계정이 작성한 질문을 모두 삭제하라는 의미</p>

<p>임의로 작성자를 추가한 적이 있다. 이번 실습 조건과 충돌이 있어 오류가 났다.</p>

<ol>
  <li>지난번에 텍스트 타입으로 author 칼럼을 만들었던  마이그레이션 스크립트를 삭제했다.
그 이후에 생성된 스크립트들도 같이 삭제한다.</li>
  <li>데이터베이스에 있는 author filed를 삭제해서 원래대로 돌렸다.</li>
  <li>그리고 makemigration 을 해서 스크립트를 새로 만들었다.</li>
</ol>

<p>views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">'common:login'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">answer_create</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AnswerForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="p">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">answer</span><span class="p">.</span><span class="n">create_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">answer</span><span class="p">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">question</span>
            <span class="n">answer</span><span class="p">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">user</span>
            <span class="n">answer</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'pybo:detail'</span><span class="p">,</span> <span class="n">question_id</span><span class="o">=</span><span class="n">question</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseNotAllowed</span><span class="p">(</span><span class="s">'only POST is allowed'</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'question'</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span> <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'pybo/question_detail.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="o">@</span><span class="n">login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">'common:login'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">question_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>  <span class="c1"># '질문 등록' 화면에서 [저장하기] 버튼을 누른 경우 -&gt; 질문 내용을 데이터베이스에 저장해야 함.
</span>        <span class="n">form</span> <span class="o">=</span> <span class="n">QuestionForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c1"># request.POST를 인수로 QuestionForm을 생성할 경우에는
</span>        <span class="c1"># request.POST에 담긴 subject, content 값이 QuestionForm의 subject, content 속성에 자동으로 저장되어 객체가 생성된다.
</span>        <span class="k">if</span> <span class="n">form</span><span class="p">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">question</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># 임시저장
</span>            <span class="n">question</span><span class="p">.</span><span class="n">create_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">question</span><span class="p">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">user</span>
            <span class="n">question</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'pybo:index'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># '질문 목록' 화면에서 직접 접속한 경우
</span>        <span class="n">form</span> <span class="o">=</span> <span class="n">QuestionForm</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'pybo/question_form.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">request.user</code>는 현재 로그인한 계정의 User 모델 객체이다.</p>

<p><code class="language-plaintext highlighter-rouge">request.user</code>에는 로그아웃 상태이면 <code class="language-plaintext highlighter-rouge">AnonymousUser</code> 객체가, 로그인 상태이면 <code class="language-plaintext highlighter-rouge">User</code> 객체가 들어있는데,</p>

<p><code class="language-plaintext highlighter-rouge">@login_required</code> 애너테이션이 붙은 함수는 로그인이 필요한 함수를 의미한다.</p>

<p>로그아웃 상태에서 <code class="language-plaintext highlighter-rouge">@login_required</code> 어노테이션이 적용된 함수가 호출되면 자동으로 로그인 화면으로 이동하게 된다.</p>

<p>login.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "base.html" %}

{% block content %}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container my-3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"{% url 'common:login' %}"</span><span class="nt">&gt;</span>
        {% csrf_token %}
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"next"</span> <span class="na">value=</span><span class="s">"{{ next }}"</span><span class="nt">&gt;</span>
        {% include "form_errors.html" %}
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"username"</span><span class="nt">&gt;</span>사용자 ID<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"username"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"{{ form.username.value|default_if_none:'' }}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"password"</span><span class="nt">&gt;</span>비밀번호<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"{{ form.password.value|default_if_none:'' }}"</span>
        <span class="err">&lt;/</span><span class="na">div</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>로그인<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
{% endblock %}
</code></pre></div></div>

<p>question_detail.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"content"</span> <span class="na">class=</span><span class="s">"form-label"</span><span class="nt">&gt;</span>답변 내용<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="err">{%</span> <span class="na">if</span> <span class="na">not</span> <span class="na">user.is_authenticated</span> <span class="err">%}</span><span class="na">disabled</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span> <span class="na">name=</span><span class="s">"content"</span> <span class="na">id=</span><span class="s">"content"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="html-화면에-글쓴이-추가">html 화면에 글쓴이 추가</h3>

<p>question_list.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"text-center table-dark"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;th&gt;</span>번호<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th</span> <span class="na">style=</span><span class="s">"width:50%"</span><span class="nt">&gt;</span>제목<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>글쓴이<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>작성 일시<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
</code></pre></div></div>

<p>제목의 너비가 전체에서 50%를 차지하도록</p>

<p>question_detail.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"badge bg-light text-dark p-2 text-start"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-2"</span><span class="nt">&gt;</span>{{ question.author.username }}<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>{{ answer.create_date }}<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>


</div>



<div class="pagination">
  
    <a href="/2022-08-25/jump-to-django-9" class="left arrow">&#8592;</a>
  
  
    <a href="/2022-08-23/jump-to-django-7" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>
    </main>

    <footer>
  <span>
    &copy; <time datetime="2023-07-31 21:14:23 +0900">2023</time> Sunmi Moon. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
  </span>
</footer>

  </body>
</html>
